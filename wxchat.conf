# --- 基础信息 ---
local app_id="wxchat"
local app_name="WxChat"
local app_text="MoviePilot微信转发代理Docker"
local app_url="https://github.com/DDSRem-Dev/wxchat-Docker"
local docker_name="wxchat"
local docker_port="16880"   # 默认端口，对应容器内的 80
local app_size="1"

# --- 核心逻辑 ---

# 1. 安装函数
docker_app_install() {
    local install_path="/home/docker/${app_id}"

    mkdir -p "${install_path}" || return
    cd "${install_path}" || return

    cat > docker-compose.yml <<EOF
version: '3.3'
services:
  wxchat:
    container_name: ${docker_name}
    image: ddsderek/wxchat:latest
    restart: always
    ports:
      - "${docker_port}:80"
    environment:
      - TZ=Asia/Shanghai
EOF

    if docker compose version >/dev/null 2>&1; then
        docker compose up -d
    else
        docker-compose up -d
    fi

    echo "安装完成"
    echo "访问地址: http://IP:${docker_port}"
}

# 2. 更新函数
docker_app_update() {
    local install_path="/home/docker/${app_id}"
    cd "${install_path}" || { echo "目录不存在"; return; }

    if docker compose version >/dev/null 2>&1; then
        docker compose pull
        docker compose up -d
    else
        docker-compose pull
        docker-compose up -d
    fi

    echo "更新完成"
}

# 3. 卸载函数
docker_app_uninstall() {
    local install_path="/home/docker/${app_id}"
    cd "${install_path}" || { echo "目录不存在"; return; }

    if docker compose version >/dev/null 2>&1; then
        docker compose down --rmi all
    else
        docker-compose down --rmi all
    fi

    cd ..
    rm -rf "${install_path}"

    echo "卸载完成"
}

# --- 结尾必须包含此行 ---
docker_app_plus

