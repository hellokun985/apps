# Homepage Configuration for kejilion/apps
# Official: https://github.com/gethomepage/homepage
# Highly customizable dashboard for self-hosted services

local app_id="homepage"
local app_name="Homepage"
local app_text="高度可定制的自托管服务仪表盘，支持Docker集成与100+服务小部件"
local app_url="https://github.com/gethomepage/homepage"
local docker_name="homepage"
local docker_port="8207"
local app_size="1"

docker_app_install() {
    local app_dir="/home/docker/${app_name}"
    mkdir -p "${app_dir}"
    cd "${app_dir}" || return 1

    # 下载官方 docker-compose.yml（使用 gh_proxy 确保可访问）
    curl -sL -o docker-compose.yml "${gh_proxy}raw.githubusercontent.com/gethomepage/homepage/main/docker-compose.yml"

    # 替换默认端口 3000 为用户自定义端口
    sed -i "s/3000:3000/${docker_port}:3000/g" docker-compose.yml

    # 启动容器
    docker compose up -d

    # 显示访问信息
    check_docker_app_ip "${docker_name}" "${docker_port}"
    echo "Homepage 已部署完成！"
    echo "首次访问：http://您的IP:${docker_port}"
    echo "请在 /home/docker/Homepage/config 目录下编辑 settings.yml、services.yml 等文件进行自定义。"
    echo "可选：挂载 /var/run/docker.sock 以启用自动服务发现与容器状态监控。"
}

docker_app_update() {
    local app_dir="/home/docker/${app_name}"
    cd "${app_dir}" || return 1
    docker compose pull
    docker compose up -d
    echo "Homepage 已更新至最新版本。"
}

docker_app_uninstall() {
    local app_dir="/home/docker/${app_name}"
    cd "${app_dir}" || return 1
    docker compose down --rmi all
    rm -rf "${app_dir}"
    echo "Homepage 已彻底卸载，包括所有配置数据。"
}

# 注册到平台
docker_app_plus "${app_id}" "${app_name}" "${app_text}" "${app_url}" "${docker_port}"

# 额外说明：首次启动后，容器会自动在 config 目录生成示例 YAML 文件（settings.yml 等）
# 推荐配置：启用 Docker 集成需添加 volumes: - /var/run/docker.sock:/var/run/docker.sock:ro
# 安全建议：生产环境建议通过反向代理（如 Nginx Proxy Manager）添加认证与 HTTPS
